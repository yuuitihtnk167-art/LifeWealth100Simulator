<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LifeWealth 100 Simulator</title>
  <meta name="theme-color" content="#f4f0e6">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <header class="app-header">
      <p class="eyebrow">LifeWealth 100 Simulator</p>
      <h1>100歳時点の資産を、いまの前提で正確に確認</h1>
      <p class="subtext">月次の運用と収支を反映します。</p>
      <nav class="page-tabs" aria-label="パラメーター選択">
        <button class="tab-button is-active" type="button" data-page="core">基本</button>
        <button class="tab-button" type="button" data-page="import">データ更新</button>
        <button class="tab-button" type="button" data-page="cashflow">現役の収入・支出</button>
        <button class="tab-button" type="button" data-page="retire-cashflow">定年後の収入・支出</button>
        <button class="tab-button" type="button" data-page="investment">投資</button>
      </nav>
    </header>

    <main class="content">
      <section class="card inputs page" data-page="core">
        <h2>入力</h2>
        <label>
          誕生日
          <input id="birthDate" type="date" required>
        </label>
        <label>
          現在の資産総額（円）
          <input id="currentAssets" type="number" min="0" step="10000" value="15000000" required>
        </label>
        <button id="exportCsv" type="button">年次CSVをダウンロード</button>
        <div class="export-panel">
          <label>
            開始年
            <select id="statementYearFrom"></select>
          </label>
          <label>
            終了年
            <select id="statementYearTo"></select>
          </label>
          <div class="export-actions">
            <button id="exportBalanceSheetDecade" type="button">期間指定貸借対照表CSV</button>
            <button id="exportProfitLossDecade" type="button">期間指定損益計算書CSV</button>
          </div>
        </div>
        <p class="import-status" id="importStatus">未取り込み</p>
      </section>

      <section class="card result page" data-page="core" aria-live="polite">
        <h2>100歳時点の資産残高</h2>
        <div class="result-value" id="resultValue">-</div>
        <div class="result-meta" id="resultMeta">前提を入力してください。</div>
      </section>

      <section class="card import page" data-page="import">
        <h2>マネーフォワード取り込み</h2>
        <label>
          資産一覧（表データを貼り付け）
          <textarea id="assetData" rows="6" placeholder="資産区分\t大分類\t...\t金額(円)\t..."></textarea>
        </label>
        <label>
          資産推移（月次など）（表データを貼り付け）
          <textarea id="summaryData" rows="4" placeholder="日付\t合計（円）\t..."></textarea>
        </label>
        <button id="applyImport" type="button">マネーフォワード取り込み</button>
        <div class="sync-panel">
          <h3>入力データのバックアップ</h3>
          <p class="helper-text">PCのフォルダーに保存/復元します。</p>
          <div class="sync-actions">
            <button id="exportSyncFolder" type="button">フォルダーにバックアップ</button>
            <button id="importSyncFile" type="button">ファイルから復元</button>
            <input id="syncFileInput" class="sync-file-input" type="file" accept="application/json">
          </div>
          <p class="sync-status" id="syncStatus">-</p>
        </div>
      </section>

      <section class="card income page" data-page="cashflow">
        <h2>現役の収入パラメーター</h2>
        <p class="helper-text">マネーフォワードの12か月平均（円）を入力します。</p>
        <div class="income-grid">
          <label>
            給与
            <input class="income-input" data-income-key="salary" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            月給以外
            <input class="income-input" data-income-key="bonus" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            配当所得
            <input class="income-input" data-income-key="dividend" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            その他入金
            <input class="income-input" data-income-key="other" type="number" min="0" step="1000" inputmode="numeric">
          </label>
        </div>
        <div class="income-summary">
          <span>月の平均収入</span>
          <strong id="monthlyIncome">-</strong>
        </div>
      </section>

      <section class="card expenses page" data-page="cashflow">
        <h2>現役の支出パラメーター</h2>
        <p class="helper-text">マネーフォワードの12か月平均（円）を入力します。</p>
        <div class="expense-grid">
          <label>
            住宅
            <input class="expense-input" data-expense-key="housing" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            自動車
            <input class="expense-input" data-expense-key="car" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            現金・カード
            <input class="expense-input" data-expense-key="cashcard" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            通信費
            <input class="expense-input" data-expense-key="telecom" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            水道光熱費
            <input class="expense-input" data-expense-key="utilities" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            食費
            <input class="expense-input" data-expense-key="food" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            趣味・娯楽
            <input class="expense-input" data-expense-key="hobby" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            保険
            <input class="expense-input" data-expense-key="insurance" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            特別な支出
            <input class="expense-input" data-expense-key="special" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            日用品
            <input class="expense-input" data-expense-key="daily" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            健康・医療
            <input class="expense-input" data-expense-key="medical" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            交際費
            <input class="expense-input" data-expense-key="social" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            交通費
            <input class="expense-input" data-expense-key="transport" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            その他
            <input class="expense-input" data-expense-key="other" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            衣服・美容
            <input class="expense-input" data-expense-key="fashion" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            税・社会保障
            <input class="expense-input" data-expense-key="tax" type="number" min="0" step="1000" inputmode="numeric">
          </label>
        </div>
        <div class="expense-summary">
          <span>月の平均支出</span>
          <strong id="monthlyExpense">-</strong>
        </div>
      </section>

      <section class="card income page" data-page="retire-cashflow">
        <h2>定年後の収入</h2>
        <label>
          定年年齢
          <input id="retirementAge" type="number" min="0" max="120" step="1" value="60" required>
        </label>
        <p class="helper-text">定年後の12か月平均（円）を入力します。</p>
        <div class="income-grid">
          <label>
            給与
            <input class="retire-income-input" data-income-key="salary" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            月給以外
            <input class="retire-income-input" data-income-key="bonus" type="number" min="0" step="1000" inputmode="numeric">
          </label>
        </div>
        <div class="income-summary">
          <span>定年後の月平均収入</span>
          <strong id="monthlyRetireIncome">-</strong>
        </div>
        <label>
          定年後の収入がある年齢（給与・月給以外・不動産所得）
          <input id="retirementIncomeEndAge" type="number" min="0" max="120" step="1" value="75" required>
        </label>
        <div class="income-subsection">
          <h3>年金生活時の収入</h3>
          <label>
            年金収入
            <input class="pension-income-input" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <div class="income-summary">
            <span>年金生活時の月平均収入</span>
            <strong id="monthlyPensionIncome">-</strong>
          </div>
        </div>
        <p class="helper-text">配当所得・その他入金は現役の値を引き継ぎます。</p>
      </section>

      <section class="card expenses page" data-page="retire-cashflow">
        <h2>定年後の支出</h2>
        <p class="helper-text">定年後の12か月平均（円）を入力します。</p>
        <div class="expense-grid">
          <label>
            住宅
            <input class="retire-expense-input" data-expense-key="housing" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            自動車
            <input class="retire-expense-input" data-expense-key="car" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            現金・カード
            <input class="retire-expense-input" data-expense-key="cashcard" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            通信費
            <input class="retire-expense-input" data-expense-key="telecom" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            水道光熱費
            <input class="retire-expense-input" data-expense-key="utilities" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            食費
            <input class="retire-expense-input" data-expense-key="food" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            趣味・娯楽
            <input class="retire-expense-input" data-expense-key="hobby" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            保険
            <input class="retire-expense-input" data-expense-key="insurance" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            特別な支出
            <input class="retire-expense-input" data-expense-key="special" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            日用品
            <input class="retire-expense-input" data-expense-key="daily" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            健康・医療
            <input class="retire-expense-input" data-expense-key="medical" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            交際費
            <input class="retire-expense-input" data-expense-key="social" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            交通費
            <input class="retire-expense-input" data-expense-key="transport" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            その他
            <input class="retire-expense-input" data-expense-key="other" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            衣服・美容
            <input class="retire-expense-input" data-expense-key="fashion" type="number" min="0" step="1000" inputmode="numeric">
          </label>
          <label>
            税・社会保障
            <input class="retire-expense-input" data-expense-key="tax" type="number" min="0" step="1000" inputmode="numeric">
          </label>
        </div>
        <div class="expense-summary">
          <span>定年後の月平均支出</span>
          <strong id="monthlyRetireExpense">-</strong>
        </div>
      </section>

      <section class="card investment page" data-page="investment">
        <h2>投資パラメーター</h2>
        <p class="helper-text">残高は資産一覧の貼り付けデータから集計されます。</p>
        <p class="alert-text" id="investmentAlert" hidden>投資合計が現金を超えています。積立額または投資残高を見直してください。</p>
        <div class="investment-summary">
          <div>
            <span>投資合計（現在）</span>
            <strong id="investmentTotal">-</strong>
          </div>
          <div>
            <span>現金残高</span>
            <strong id="cashBalance">-</strong>
          </div>
          <div>
            <span>積立合計（月額）</span>
            <strong id="investmentContribTotal">-</strong>
          </div>
        </div>
        <div class="investment-grid">
          <div class="investment-item">
            <h3>株式投資</h3>
            <label>
              残高（円）
              <input id="balanceStocks" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustStocks" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              積立（月額）
              <input id="contribStocks" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              想定利回り（年率 %）
              <input id="rateStocks" type="number" min="-100" max="100" step="0.1" inputmode="numeric">
            </label>
            <label>
              積立終了年齢
              <input id="endAgeStocks" type="number" min="0" max="120" step="1" value="65" required>
            </label>
          </div>
          <div class="investment-item">
            <h3>投資信託</h3>
            <label>
              残高（円）
              <input id="balanceFunds" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustFunds" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              積立（月額）
              <input id="contribFunds" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              想定利回り（年率 %）
              <input id="rateFunds" type="number" min="-100" max="100" step="0.1" inputmode="numeric">
            </label>
            <label>
              積立終了年齢
              <input id="endAgeFunds" type="number" min="0" max="120" step="1" value="65" required>
            </label>
          </div>
          <div class="investment-item">
            <h3>債券</h3>
            <label>
              残高（円）
              <input id="balanceBonds" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustBonds" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              平均利率（年率 %）
              <input id="rateBonds" type="number" min="-100" max="100" step="0.1" inputmode="numeric">
            </label>
            <div class="bond-rate-average" id="bondRateAverageDisplay">平均利率: -</div>
            <button id="bondDetailButton" type="button">債券入力</button>
          </div>
          <div class="investment-item">
            <h3>積立保険</h3>
            <label>
              残高（円）
              <input id="balanceInsurance" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustInsurance" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              積立（月額）
              <input id="contribInsurance" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              想定利回り（年率 %）
              <input id="rateInsurance" type="number" min="-100" max="100" step="0.1" inputmode="numeric">
            </label>
            <button id="insuranceDetailButton" type="button">保険料詳細</button>
          </div>
          <div class="investment-item">
            <h3>ドル積立</h3>
            <label>
              残高（円換算）
              <input id="balanceUsd" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustUsd" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              積立（月額）
              <input id="contribUsd" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              積立終了年齢
              <input id="endAgeUsd" type="number" min="0" max="120" step="1" value="65" required>
            </label>
          </div>
          <div class="investment-item">
            <h3>年金</h3>
            <label>
              残高（円）
              <input id="balanceDc" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <label>
              手動調整（円）
              <input id="adjustDc" type="number" step="1000" inputmode="numeric">
            </label>
            <label>
              積立（月額）
              <input id="contribDc" type="number" min="0" step="1000" inputmode="numeric">
            </label>
            <button id="pensionDetailButton" type="button">年金詳細</button>
          </div>
        </div>
        <p class="helper-text">積立は「現金から差し引き、同額を投資残高に加算する」前提で表示します。</p>
      </section>

      <section class="card page" data-page="bond-input">
        <h2 class="bond-heading">
          債券の入力
          <span class="bond-average" id="bondAverageRate">平均利率: -</span>
        </h2>
        <p class="helper-text">償還日に債券残高が現金へ振替されます（円未満切り捨て）。</p>
        <label>
          USD/JPY（円）
          <input id="bondUsdRate" type="number" min="0" step="0.01" inputmode="decimal" placeholder="例: 150.25">
        </label>
        <div class="bond-table">
          <table>
            <thead>
              <tr>
                <th>銘柄名</th>
                <th>現金</th>
                <th>通貨</th>
                <th>保有額面</th>
                <th>所得単価</th>
                <th>償還日</th>
                <th>利率（%）</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="bondTableBody"></tbody>
          </table>
        </div>
        <div class="bond-actions">
          <button id="addBondRow" type="button">債券を追加</button>
          <button id="sortBondRows" type="button">償還日順に更新</button>
          <span class="bond-total" id="bondTotalAmount">合計: -</span>
        </div>
        <div class="bond-matured">
          <h3>償還済み</h3>
          <div class="bond-table">
            <table>
              <thead>
                <tr>
                  <th>銘柄名</th>
                  <th>通貨</th>
                  <th>保有額面</th>
                  <th>所得単価</th>
                  <th>償還日</th>
                  <th>利率（%）</th>
                  <th>償還日確定</th>
                </tr>
              </thead>
              <tbody id="bondMaturedBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="card page" data-page="insurance-detail">
        <h2>保険料詳細</h2>
        <div class="insurance-current">
          <span>現在の保険積立額（月）</span>
          <strong id="insuranceCurrentAmount">-</strong>
        </div>
        <p class="helper-text">
          保険商品ごとに名称・保険料（月額）・終了年月を入力してください。
        </p>
        <div class="insurance-plan">
          <table>
            <thead>
              <tr>
                <th>名称</th>
                <th>保険料（円／月）</th>
                <th>終了年月</th>
                <th>メモ</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="insurancePlanBody"></tbody>
          </table>
        </div>
        <button id="addInsurancePlanRow" type="button">保険商品を追加</button>
      </section>

      <section class="card page" data-page="pension-detail">
        <h2>年金詳細</h2>
        <div class="pension-current">
          <span>現在の年金残高</span>
          <strong id="pensionCurrentAmount">-</strong>
        </div>
        <p class="helper-text">
          年金ごとに拠出金額（積立）と受給開始年齢を設定します。受給開始後は積み立てた年金から現金へ振替されます。
        </p>
        <div class="pension-plan">
          <table>
            <thead>
              <tr>
                <th>名称</th>
                <th>受給開始年齢</th>
                <th>拠出金額（円／月）</th>
                <th>振替</th>
                <th>分割金額（円／年）</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="pensionPlanBody"></tbody>
          </table>
        </div>
        <button id="addPensionPlanRow" type="button">年金を追加</button>
        <div class="pension-changes">
          <h3>将来の拠出金額変更</h3>
          <div class="pension-plan">
            <table>
              <thead>
                <tr>
                  <th>対象年金</th>
                  <th>変更年齢</th>
                  <th>変更後金額（円／月）</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="pensionChangeBody"></tbody>
            </table>
          </div>
        </div>
        <button id="addPensionChangeRow" type="button">変更を追加</button>
      </section>
    </main>
    <footer class="update-footer">
      <span id="lastUpdated">更新日時: -</span>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
